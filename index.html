<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
  <title>GAINZ</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- Favicon using .ico -->
<link rel="icon" href="assets/logo.ico" type="image/x-icon">

<!-- Optional: Favicon for Apple devices -->
<link rel="apple-touch-icon" href="assets/logo.ico">
</head>
<body>
<div class="logo-background">
  <img src="assets/logo.png" alt="Logo">
</div>
  <div class="container" id="login-container">
    <h2>Admin Login</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    
    <button class="login-btn" onclick="login()">Login</button>
    <p style="text-align: right;margin-left: 50%; margin-top: 10px; color: #ccc;
text-decoration: underline;">
  <a href="#" onclick="resetPassword()" style="color: #ffffff; font-size: 0.9rem;">Forgot Password?</a>
</p>
    <p id="error-message"></p>
  </div>

  <div class="container hidden" id="dashboard-container">
    <h2>Welcome, Admin</h2>
<nav class="tab-navbar-horizontal clean-navbar">
  <ul class="tab-menu clean-tab-menu">
    <li class="tab-item active" onclick="showTab('members')">
      <i data-feather="users"></i>
      <span>Members</span>
    </li>
    <li class="tab-item" onclick="showTab('add')">
      <i data-feather="folder-plus"></i>
      <span>Add Member</span>
    </li>
    <li class="tab-item" onclick="showTab('admin')">
      <i data-feather="user-plus"></i>
      <span>Add Admin</span>
    </li>
    <li class="tab-item logout-tab" onclick="logout()">
      <i data-feather="log-out"></i>
    </li>
  </ul>
</nav>



    <div id="tab-members" class="tab-content">
      <h3>All Members</h3>
      <div style="display: flex; gap: 6px; margin-bottom: 10px; align-items: center; flex-wrap: nowrap;">
  <input type="text" id="searchInput" placeholder="Search " oninput="filterMembers()" 
         style="flex: 1; min-width: 40%; padding: 8px; font-size: 1rem;">

  <select id="typeFilter" onchange="filterMembers()" style="flex: 1;padding: 8px; font-size: 0.85rem; min-width: 25%;">
  <option value="">All Types</option>
  <option value="Regular">Regular</option>
  <option value="Student">Student</option>
</select>

<select id="statusFilter" onchange="filterMembers()" style="flex: 1;padding: 8px; font-size: 0.85rem; min-width: 25%;">
  <option value="">All Status</option>
  <option value="active">Active</option>
  <option value="expired">Expired</option>
</select>  
</div>
      <div id="member-list"></div>
    </div>

    <div id="tab-add" class="tab-content hidden">
      
      <div class="input-wrapper">
        <h3>Add New Member</h3>
      <input type="text" id="memberNumber" placeholder="Member Number" required />
      <input type="text" id="newName" placeholder="Full Name" required />
      <select id="memberType" onchange="updateMembershipDetails()">
        <option value="Regular">Regular (‚Ç±600)</option>
        <option value="Student">Student (‚Ç±500)</option>
      </select>
      <label for="startDate">Start Date</label>
      <input type="datetime-local" id="startDate" />
      <label for="expiresAt">Expires At</label>
      <input type="datetime-local" id="expiresAt" />
      <p>Price: ‚Ç±<span id="priceDisplay">600</span></p>
      <button onclick="addMember()">Add Member</button>
      <p id="addMessage"></p>
      </div>
      
    </div>

<div id="tab-admin" class="tab-content hidden">
  
  <div class="input-wrapper">
    <h3>Add New Admin</h3>
    <input type="email" id="adminEmail" placeholder="Enter admin email" />
    <input type="password" id="adminPassword" placeholder="Enter password" />
    <button onclick="addAdmin()">Add Admin</button>
    <p id="adminMessage"></p>
  </div>
  </div>
</div>
</div>

  </div>
<!-- Edit Modal -->
<div id="editModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#00000099; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:8px; width:300px;">
    <div style="display: flex; justify-content: space-between;align-items: baseline;">
      <h4 style="margin: 0;">Edit Member</h4>    
      <div style="display: flex; gap: 12px; margin-bottom: 5%; ">
        <button id="removeImageBtn" class="cancelEditBtn small-btn" onclick="confirmRemoveMemberImage()" title="Remove Image">
          Remove Image
        </button>
        <button id="deleteMemberBtn" class="delete-btn small-btn" onclick="confirmDeleteMember()" title="Delete Member">
          üóëÔ∏è
        </button>
      </div>
    </div>
    <input id="editMemberNumber" type="text" placeholder="Member Number" style="width:100%; margin:10px 0; padding:8px; border:1px solid #ccc; border-radius:4px;">
    <input id="editName" type="text" placeholder="Name" style="width:100%; margin-bottom:10px;"><br>
    <select id="editType" style="width:100%; margin-bottom:10px;">
      <option value="Regular">Regular</option>
      <option value="Student">Student</option>
    </select><br>
    <label>Start:</label><br>
    <input id="editStart" type="datetime-local" style="width:100%; margin-bottom:10px;"><br>
    <label>Expires:</label><br>
    <input id="editExpires" type="datetime-local" style="width:100%; margin-bottom:10px;"><br>
    
    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px;">
      <button id="saveEditBtn" class="save-btn" onclick="saveEdit()">Save</button>
      <button id="cancelEditBtn" onclick="closeEditModal()">Cancel</button>
    </div>
    
    <p id="editMessage" style="color:red; font-size:0.9rem;"></p>
  </div>
</div>

<!-- Renewal Confirmation Modal -->
<div id="renewModal" class="modal hidden">
  <div class="modal-content">
    <h4>Renew Membership</h4>
    <p>Are you sure you want to renew this membership?</p>

    <label for="renewPeriod">Renewal Period (in days):</label>
    <input type="number" id="renewPeriod" value="30" min="1" max="365" />

    <div class="modal-buttons">
      <button onclick="confirmRenew()">Confirm</button>
      <button onclick="closeRenewModal()">Cancel</button>
    </div>
  </div>
</div>
<!-- Error Login Modal -->
<div id="errorModal" class="modal hidden">
  <div class="modal-content">
    <h4>Login Error</h4>
    <p id="errorModalMessage"></p>
    <button onclick="closeErrorModal()">OK</button>
  </div>
</div>
<!-- Reset Password Modal -->
<div id="resetPasswordModal" class="modal hidden">
  <div class="modal-content">
    <h4>üîí Reset Password</h4>
    <p id="resetPasswordMessage"></p>
    <button onclick="closeResetPasswordModal()">OK</button>
  </div>
</div>
<!-- Image Upload Modal -->
<div id="imageUploadModal" class="modal hidden">
  <div class="modal-content">
    <h3>Profile Picture</h3>
    <p id="imageUploadMessage"></p>
    <button onclick="closeImageUploadModal()">OK</button>
  </div>
</div>
<!-- Confirm Remove Image Modal -->
<div id="confirmRemoveImageModal" class="modal hidden">
  <div class="modal-content">
    <h2>Remove Profile Image?</h2>
    <p>This action cannot be undone. Are you sure you want to remove this image?</p>
    <div class="modal-actions">
      <button id="confirmRemoveImageBtn" class="btn btn-danger">Remove</button>
      <button id="cancelRemoveImageBtn" class="btn">Cancel</button>
      
    </div>
  </div>
</div>
<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal hidden">
  <div class="modal-content">
    <h4>‚ö†Ô∏è Confirm Deletion</h4>
    <p>Are you sure you want to delete this member?</p>
    <div class="modal-buttons">
      <button onclick="deleteConfirmed()">Delete</button>
      <button onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>
</div>
<!-- Delete Result Modal -->
<div id="deleteResultModal" class="modal hidden">
  <div class="modal-content">
    <h3>Delete Member</h3>
    <p id="deleteResultMessage"></p>
    <button onclick="closeDeleteResultModal()">OK</button>
  </div>
</div>
<!-- member Modal -->
<div id="memberDetailsModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-img" id="modalImageContainer" style=" cursor: pointer;">
      <img id="modalImage" src="" alt="Member Image" class="modal-image" />
    </div>

    <!-- New Member Number element -->
    <div id="modalNumber" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></div>
    <h2 id="modalName"></h2>

    <p><strong>Type:</strong> <span id="modalType"></span></p>
    <p><strong>Price:</strong> ‚Ç±<span id="modalPrice"></span></p>
    <p><strong>Start:</strong> <span id="modalStart"></span></p>
    <p><strong>Expires:</strong> <span id="modalExpires"></span></p>
    <div class="button-group">
      <button class="edit-btn" id="modalEditBtn">Edit</button>
      <button class="renew-btn" id="modalRenewBtn">Renew</button>
    </div>
  </div>
</div>
<!-- Hidden file input for uploading member images -->
<input type="file" id="memberImageInput" accept="image/*" style="display:none" />
<script>
  window.addEventListener('DOMContentLoaded', function() {
    // Prevent modal from showing on initial load
    const modal = document.getElementById('memberDetailsModal');
    if (modal) {
      modal.style.display = 'none';
      modal.classList.add('hidden'); // <- safe backup
    }

  });
  window.addEventListener('click', function(event) {
  const modal = document.getElementById('memberDetailsModal');
  if (event.target === modal) {
    modal.style.display = 'none';
  }
});
</script>

<script>
  function openMemberDetailsModal(memberId) {
  if (!memberId || typeof memberId !== "string") return;

  const member = displayedMembers.find(m => m.id === memberId);
  


  if (!member) return;
  document.getElementById('modalImage').src = member.photoURL || 'assets/default.jpg';
  document.getElementById("modalNumber").textContent = `# ${member.memberNumber}`;
  document.getElementById('modalName').innerText = member.name;
  document.getElementById('modalType').innerText = member.type;
  document.getElementById('modalPrice').innerText = member.price;
  document.getElementById('modalStart').innerText = new Date(member.start).toLocaleString();
  document.getElementById('modalExpires').innerText = new Date(member.expires).toLocaleString();

  document.getElementById('modalEditBtn').onclick = () => editMember(member.id);
  document.getElementById('modalRenewBtn').onclick = () => openRenewModal(member.id);
  // ‚úÖ Dynamically set the image click to trigger upload
  document.getElementById('modalImageContainer').onclick = (event) => {
    event.stopPropagation();
    triggerImageUpload(member.id);
  };
  document.getElementById('memberDetailsModal').style.display = 'flex';
}
// Make function accessible from HTML onclick
window.openMemberDetailsModal = openMemberDetailsModal;
</script>

  <script src="script.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script>feather.replace()</script>
</body>
</html>
